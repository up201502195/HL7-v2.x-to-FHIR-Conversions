<!-- Convert HL7-v2.x to FHIR Patient - Example 1 -->

<channel version="3.6.0">
  <id>e678dbf5-f021-43dc-84ae-967500d5c31a</id>
  <nextMetaDataId>2</nextMetaDataId>
  <name>Convert HL7 to FHIR Patient - Example 1</name>
  <description></description>
  <revision>1</revision>
  <sourceConnector version="3.6.0">
    <metaDataId>0</metaDataId>
    <name>sourceConnector</name>
    <properties class="com.mirth.connect.connectors.vm.VmReceiverProperties" version="3.6.0">
      <pluginProperties/>
      <sourceConnectorProperties version="3.6.0">
        <responseVariable>None</responseVariable>
        <respondAfterProcessing>true</respondAfterProcessing>
        <processBatch>false</processBatch>
        <firstResponse>false</firstResponse>
        <processingThreads>1</processingThreads>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
        <queueBufferSize>1000</queueBufferSize>
      </sourceConnectorProperties>
    </properties>
    <transformer version="3.6.0">
      <elements>
        <com.mirth.connect.model.IteratorStep>
          <name>For each msg[&apos;PID&apos;][&apos;PID.3&apos;]</name>
          <sequenceNumber>0</sequenceNumber>
          <properties>
            <target>msg[&apos;PID&apos;][&apos;PID.3&apos;]</target>
            <indexVariable>i</indexVariable>
            <prefixSubstitutions>
              <string>msg[&apos;PID&apos;][&apos;PID.3&apos;]</string>
              <string>tmp[&apos;PID&apos;][&apos;PID.3&apos;]</string>
            </prefixSubstitutions>
            <children>
              <com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
                <name>Create Identifier</name>
                <sequenceNumber>0-0</sequenceNumber>
                <storeAsLocal>true</storeAsLocal>
                <mapType>CHANNEL</mapType>
                <variable>identifiers</variable>
                <definition>Identifier</definition>
                <model class="objectModel">
                  <usingBuilder>true</usingBuilder>
                  <properties class="linked-hash-map">
                    <entry>
                      <string>use</string>
                      <objectProperty>
                        <enabled>false</enabled>
                        <properties class="stringModel">
                          <stringValue>usual</stringValue>
                          <usingEnum>true</usingEnum>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>type</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="objectModel">
                          <usingBuilder>true</usingBuilder>
                          <properties class="linked-hash-map">
                            <entry>
                              <string>text</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="stringModel">
                                  <stringValue>msg[&apos;PID&apos;][&apos;PID.3&apos;][i][&apos;PID.3.5&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </properties>
                              </objectProperty>
                            </entry>
                          </properties>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>system</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="stringModel">
                          <stringValue>msg[&apos;PID&apos;][&apos;PID.3&apos;][i][&apos;PID.3.4&apos;].toString()</stringValue>
                          <scriptExpression>true</scriptExpression>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>value</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="stringModel">
                          <stringValue>msg[&apos;PID&apos;][&apos;PID.3&apos;][i][&apos;PID.3.1&apos;].toString()</stringValue>
                          <scriptExpression>true</scriptExpression>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>period</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="objectModel">
                          <usingBuilder>true</usingBuilder>
                          <properties class="linked-hash-map">
                            <entry>
                              <string>start</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="stringModel">
                                  <stringValue>convertToFhirTimestamp(msg[&apos;PID&apos;][&apos;PID.3&apos;][i][&apos;PID.3.7&apos;].toString())</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </properties>
                              </objectProperty>
                            </entry>
                            <entry>
                              <string>end</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="stringModel">
                                  <stringValue>convertToFhirTimestamp(msg[&apos;PID&apos;][&apos;PID.3&apos;][i][&apos;PID.3.8&apos;].toString())</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </properties>
                              </objectProperty>
                            </entry>
                          </properties>
                        </properties>
                      </objectProperty>
                    </entry>
                  </properties>
                </model>
              </com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
            </children>
          </properties>
        </com.mirth.connect.model.IteratorStep>
        <com.mirth.connect.model.IteratorStep>
          <name>For each msg[&apos;PID&apos;][&apos;PID.5&apos;]</name>
          <sequenceNumber>1</sequenceNumber>
          <properties>
            <target>msg[&apos;PID&apos;][&apos;PID.5&apos;]</target>
            <indexVariable>i</indexVariable>
            <prefixSubstitutions>
              <string>msg[&apos;PID&apos;][&apos;PID.5&apos;]</string>
              <string>tmp[&apos;PID&apos;][&apos;PID.5&apos;]</string>
            </prefixSubstitutions>
            <children>
              <com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
                <name>Create HumanName</name>
                <sequenceNumber>1-0</sequenceNumber>
                <storeAsLocal>true</storeAsLocal>
                <mapType>CHANNEL</mapType>
                <variable>names</variable>
                <definition>HumanName</definition>
                <model class="objectModel">
                  <usingBuilder>true</usingBuilder>
                  <properties class="linked-hash-map">
                    <entry>
                      <string>use</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="stringModel">
                          <stringValue>usual</stringValue>
                          <usingEnum>true</usingEnum>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>family</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="stringModel">
                          <stringValue>msg[&apos;PID&apos;][&apos;PID.5&apos;][i][&apos;PID.5.1&apos;].toString()</stringValue>
                          <scriptExpression>true</scriptExpression>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>given</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="arrayModel">
                          <usingBuilder>true</usingBuilder>
                          <elements>
                            <stringModel>
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.5&apos;][i][&apos;PID.5.2&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </stringModel>
                            <stringModel>
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.5&apos;][i][&apos;PID.5.3&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </stringModel>
                          </elements>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>prefix</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="arrayModel">
                          <usingBuilder>true</usingBuilder>
                          <elements>
                            <stringModel>
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.5&apos;][i][&apos;PID.5.5&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </stringModel>
                          </elements>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>suffix</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="arrayModel">
                          <usingBuilder>true</usingBuilder>
                          <elements>
                            <stringModel>
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.5&apos;][i][&apos;PID.5.4&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </stringModel>
                          </elements>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>period</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="objectModel">
                          <usingBuilder>true</usingBuilder>
                          <properties class="linked-hash-map">
                            <entry>
                              <string>start</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="stringModel">
                                  <stringValue>convertToFhirTimestamp(msg[&apos;PID&apos;][&apos;PID.5&apos;][i][&apos;PID.5.12&apos;].toString())</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </properties>
                              </objectProperty>
                            </entry>
                            <entry>
                              <string>end</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="stringModel">
                                  <stringValue>convertToFhirTimestamp(msg[&apos;PID&apos;][&apos;PID.5&apos;][i][&apos;PID.5.13&apos;].toString())</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </properties>
                              </objectProperty>
                            </entry>
                          </properties>
                        </properties>
                      </objectProperty>
                    </entry>
                  </properties>
                </model>
              </com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
            </children>
          </properties>
        </com.mirth.connect.model.IteratorStep>
        <com.mirth.connect.model.IteratorStep>
          <name>For each msg[&apos;PID&apos;][&apos;PID.9&apos;]</name>
          <sequenceNumber>2</sequenceNumber>
          <properties>
            <target>msg[&apos;PID&apos;][&apos;PID.9&apos;]</target>
            <indexVariable>i</indexVariable>
            <prefixSubstitutions>
              <string>msg[&apos;PID&apos;][&apos;PID.9&apos;]</string>
              <string>tmp[&apos;PID&apos;][&apos;PID.9&apos;]</string>
            </prefixSubstitutions>
            <children>
              <com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
                <name>Create HumanName</name>
                <sequenceNumber>2-0</sequenceNumber>
                <storeAsLocal>true</storeAsLocal>
                <mapType>CHANNEL</mapType>
                <variable>aliases</variable>
                <definition>HumanName</definition>
                <model class="objectModel">
                  <usingBuilder>true</usingBuilder>
                  <properties class="linked-hash-map">
                    <entry>
                      <string>use</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="stringModel">
                          <stringValue>usual</stringValue>
                          <usingEnum>true</usingEnum>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>family</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="stringModel">
                          <stringValue>msg[&apos;PID&apos;][&apos;PID.9&apos;][i][&apos;PID.9.1&apos;].toString()</stringValue>
                          <scriptExpression>true</scriptExpression>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>given</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="arrayModel">
                          <usingBuilder>true</usingBuilder>
                          <elements>
                            <stringModel>
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.9&apos;][i][&apos;PID.9.2&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </stringModel>
                            <stringModel>
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.9&apos;][i][&apos;PID.9.3&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </stringModel>
                          </elements>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>prefix</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="arrayModel">
                          <usingBuilder>true</usingBuilder>
                          <elements>
                            <stringModel>
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.9&apos;][i][&apos;PID.9.5&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </stringModel>
                          </elements>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>suffix</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="arrayModel">
                          <usingBuilder>true</usingBuilder>
                          <elements>
                            <stringModel>
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.9&apos;][i][&apos;PID.9.4&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </stringModel>
                          </elements>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>period</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="objectModel">
                          <usingBuilder>true</usingBuilder>
                          <properties class="linked-hash-map">
                            <entry>
                              <string>start</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="stringModel">
                                  <stringValue>convertToFhirTimestamp(msg[&apos;PID&apos;][&apos;PID.9&apos;][i][&apos;PID.9.12&apos;].toString())</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </properties>
                              </objectProperty>
                            </entry>
                            <entry>
                              <string>end</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="stringModel">
                                  <stringValue>convertToFhirTimestamp(msg[&apos;PID&apos;][&apos;PID.9&apos;][i][&apos;PID.9.13&apos;].toString())</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </properties>
                              </objectProperty>
                            </entry>
                          </properties>
                        </properties>
                      </objectProperty>
                    </entry>
                  </properties>
                </model>
              </com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
            </children>
          </properties>
        </com.mirth.connect.model.IteratorStep>
        <com.mirth.connect.model.IteratorStep>
          <name>For each msg[&apos;PID&apos;][&apos;PID.13&apos;]</name>
          <sequenceNumber>3</sequenceNumber>
          <properties>
            <target>msg[&apos;PID&apos;][&apos;PID.13&apos;]</target>
            <indexVariable>i</indexVariable>
            <prefixSubstitutions>
              <string>msg[&apos;PID&apos;][&apos;PID.13&apos;]</string>
              <string>tmp[&apos;PID&apos;][&apos;PID.13&apos;]</string>
            </prefixSubstitutions>
            <children>
              <com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
                <name>Create ContactPoint</name>
                <sequenceNumber>3-0</sequenceNumber>
                <storeAsLocal>true</storeAsLocal>
                <mapType>CHANNEL</mapType>
                <variable>homePhoneNumbers</variable>
                <definition>ContactPoint</definition>
                <model class="objectModel">
                  <usingBuilder>true</usingBuilder>
                  <properties class="linked-hash-map">
                    <entry>
                      <string>system</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="stringModel">
                          <stringValue>phone</stringValue>
                          <usingEnum>true</usingEnum>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>value</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="stringModel">
                          <stringValue>msg[&apos;PID&apos;][&apos;PID.13&apos;][i][&apos;PID.13.1&apos;].toString()</stringValue>
                          <scriptExpression>true</scriptExpression>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>use</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="stringModel">
                          <stringValue>home</stringValue>
                          <usingEnum>true</usingEnum>
                        </properties>
                      </objectProperty>
                    </entry>
                  </properties>
                </model>
              </com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
            </children>
          </properties>
        </com.mirth.connect.model.IteratorStep>
        <com.mirth.connect.model.IteratorStep>
          <name>For each msg[&apos;PID&apos;][&apos;PID.14&apos;]</name>
          <sequenceNumber>4</sequenceNumber>
          <properties>
            <target>msg[&apos;PID&apos;][&apos;PID.14&apos;]</target>
            <indexVariable>i</indexVariable>
            <prefixSubstitutions>
              <string>msg[&apos;PID&apos;][&apos;PID.14&apos;]</string>
              <string>tmp[&apos;PID&apos;][&apos;PID.14&apos;]</string>
            </prefixSubstitutions>
            <children>
              <com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
                <name>Create ContactPoint</name>
                <sequenceNumber>4-0</sequenceNumber>
                <storeAsLocal>true</storeAsLocal>
                <mapType>CHANNEL</mapType>
                <variable>businessPhoneNumbers</variable>
                <definition>ContactPoint</definition>
                <model class="objectModel">
                  <usingBuilder>true</usingBuilder>
                  <properties class="linked-hash-map">
                    <entry>
                      <string>system</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="stringModel">
                          <stringValue>phone</stringValue>
                          <usingEnum>true</usingEnum>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>value</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="stringModel">
                          <stringValue>msg[&apos;PID&apos;][&apos;PID.14&apos;][i][&apos;PID.14.1&apos;].toString()</stringValue>
                          <scriptExpression>true</scriptExpression>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>use</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="stringModel">
                          <stringValue>work</stringValue>
                          <usingEnum>true</usingEnum>
                        </properties>
                      </objectProperty>
                    </entry>
                  </properties>
                </model>
              </com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
            </children>
          </properties>
        </com.mirth.connect.model.IteratorStep>
        <com.mirth.connect.model.IteratorStep>
          <name>For each msg[&apos;PID&apos;][&apos;PID.11&apos;]</name>
          <sequenceNumber>5</sequenceNumber>
          <properties>
            <target>msg[&apos;PID&apos;][&apos;PID.11&apos;]</target>
            <indexVariable>i</indexVariable>
            <prefixSubstitutions>
              <string>msg[&apos;PID&apos;][&apos;PID.11&apos;]</string>
              <string>tmp[&apos;PID&apos;][&apos;PID.11&apos;]</string>
            </prefixSubstitutions>
            <children>
              <com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
                <name>Create Address</name>
                <sequenceNumber>5-0</sequenceNumber>
                <storeAsLocal>true</storeAsLocal>
                <mapType>CHANNEL</mapType>
                <variable>addresses</variable>
                <definition>Address</definition>
                <model class="objectModel">
                  <usingBuilder>true</usingBuilder>
                  <properties class="linked-hash-map">
                    <entry>
                      <string>use</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="stringModel">
                          <stringValue>convertAddressUse(msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.7&apos;].toString())</stringValue>
                          <scriptExpression>true</scriptExpression>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>type</string>
                      <objectProperty>
                        <enabled>false</enabled>
                        <properties class="stringModel">
                          <stringValue>postal</stringValue>
                          <usingEnum>true</usingEnum>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>text</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="stringModel">
                          <stringValue>(msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.1&apos;].toString() + &apos; &apos; + msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.2&apos;].toString() + &apos; &apos; + msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.3&apos;].toString() + &apos; &apos; + msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.4&apos;].toString() + &apos; &apos; + msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.5&apos;].toString() + &apos; &apos; + msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.6&apos;].toString()).trim()</stringValue>
                          <scriptExpression>true</scriptExpression>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>line</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="arrayModel">
                          <usingBuilder>true</usingBuilder>
                          <elements>
                            <stringModel>
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.1&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </stringModel>
                            <stringModel>
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.2&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </stringModel>
                          </elements>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>city</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="stringModel">
                          <stringValue>msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.3&apos;].toString()</stringValue>
                          <scriptExpression>true</scriptExpression>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>district</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="stringModel">
                          <stringValue>msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.9&apos;].toString()</stringValue>
                          <scriptExpression>true</scriptExpression>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>state</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="stringModel">
                          <stringValue>msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.4&apos;].toString()</stringValue>
                          <scriptExpression>true</scriptExpression>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>postalCode</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="stringModel">
                          <stringValue>msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.5&apos;].toString()</stringValue>
                          <scriptExpression>true</scriptExpression>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>country</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="stringModel">
                          <stringValue>msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.6&apos;].toString()</stringValue>
                          <scriptExpression>true</scriptExpression>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>period</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="objectModel">
                          <usingBuilder>true</usingBuilder>
                          <properties class="linked-hash-map">
                            <entry>
                              <string>start</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="stringModel">
                                  <stringValue>convertToFhirTimestamp(msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.13&apos;].toString())</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </properties>
                              </objectProperty>
                            </entry>
                            <entry>
                              <string>end</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="stringModel">
                                  <stringValue>convertToFhirTimestamp(msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.14&apos;].toString())</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </properties>
                              </objectProperty>
                            </entry>
                          </properties>
                        </properties>
                      </objectProperty>
                    </entry>
                  </properties>
                </model>
              </com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
            </children>
          </properties>
        </com.mirth.connect.model.IteratorStep>
        <com.mirth.connect.model.IteratorStep>
          <name>For each msg[&apos;NK1&apos;]</name>
          <sequenceNumber>6</sequenceNumber>
          <properties>
            <target>msg[&apos;NK1&apos;]</target>
            <indexVariable>i</indexVariable>
            <prefixSubstitutions>
              <string>msg[&apos;NK1&apos;]</string>
              <string>tmp[&apos;NK1&apos;]</string>
            </prefixSubstitutions>
            <children>
              <com.mirth.connect.model.IteratorStep>
                <name>For each msg[&apos;NK1&apos;][i][&apos;NK1.5&apos;]</name>
                <sequenceNumber>6-0</sequenceNumber>
                <properties>
                  <target>msg[&apos;NK1&apos;][i][&apos;NK1.5&apos;]</target>
                  <indexVariable>j</indexVariable>
                  <prefixSubstitutions>
                    <string>msg[&apos;NK1&apos;][i][&apos;NK1.5&apos;]</string>
                    <string>tmp[&apos;NK1&apos;][i][&apos;NK1.5&apos;]</string>
                  </prefixSubstitutions>
                  <children>
                    <com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
                      <name>Create ContactPoint</name>
                      <sequenceNumber>6-0-0</sequenceNumber>
                      <storeAsLocal>true</storeAsLocal>
                      <mapType>CHANNEL</mapType>
                      <variable>contactHomePhoneNumbers</variable>
                      <definition>ContactPoint</definition>
                      <model class="objectModel">
                        <usingBuilder>true</usingBuilder>
                        <properties class="linked-hash-map">
                          <entry>
                            <string>system</string>
                            <objectProperty>
                              <enabled>true</enabled>
                              <properties class="stringModel">
                                <stringValue>phone</stringValue>
                                <usingEnum>true</usingEnum>
                              </properties>
                            </objectProperty>
                          </entry>
                          <entry>
                            <string>value</string>
                            <objectProperty>
                              <enabled>true</enabled>
                              <properties class="stringModel">
                                <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.5&apos;][j][&apos;NK1.5.1&apos;].toString()</stringValue>
                                <scriptExpression>true</scriptExpression>
                              </properties>
                            </objectProperty>
                          </entry>
                          <entry>
                            <string>use</string>
                            <objectProperty>
                              <enabled>true</enabled>
                              <properties class="stringModel">
                                <stringValue>home</stringValue>
                                <usingEnum>true</usingEnum>
                              </properties>
                            </objectProperty>
                          </entry>
                        </properties>
                      </model>
                    </com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
                  </children>
                </properties>
              </com.mirth.connect.model.IteratorStep>
            </children>
          </properties>
        </com.mirth.connect.model.IteratorStep>
        <com.mirth.connect.model.IteratorStep>
          <name>For each msg[&apos;NK1&apos;]</name>
          <sequenceNumber>7</sequenceNumber>
          <properties>
            <target>msg[&apos;NK1&apos;]</target>
            <indexVariable>i</indexVariable>
            <prefixSubstitutions>
              <string>msg[&apos;NK1&apos;]</string>
              <string>tmp[&apos;NK1&apos;]</string>
            </prefixSubstitutions>
            <children>
              <com.mirth.connect.model.IteratorStep>
                <name>For each msg[&apos;NK1&apos;][i][&apos;NK1.6&apos;]</name>
                <sequenceNumber>7-0</sequenceNumber>
                <properties>
                  <target>msg[&apos;NK1&apos;][i][&apos;NK1.6&apos;]</target>
                  <indexVariable>j</indexVariable>
                  <prefixSubstitutions>
                    <string>msg[&apos;NK1&apos;][i][&apos;NK1.6&apos;]</string>
                    <string>tmp[&apos;NK1&apos;][i][&apos;NK1.6&apos;]</string>
                  </prefixSubstitutions>
                  <children>
                    <com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
                      <name>Create ContactPoint</name>
                      <sequenceNumber>7-0-0</sequenceNumber>
                      <storeAsLocal>true</storeAsLocal>
                      <mapType>CHANNEL</mapType>
                      <variable>contactBusinessPhoneNumbers</variable>
                      <definition>ContactPoint</definition>
                      <model class="objectModel">
                        <usingBuilder>true</usingBuilder>
                        <properties class="linked-hash-map">
                          <entry>
                            <string>system</string>
                            <objectProperty>
                              <enabled>true</enabled>
                              <properties class="stringModel">
                                <stringValue>phone</stringValue>
                                <usingEnum>true</usingEnum>
                              </properties>
                            </objectProperty>
                          </entry>
                          <entry>
                            <string>value</string>
                            <objectProperty>
                              <enabled>true</enabled>
                              <properties class="stringModel">
                                <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.6&apos;][j][&apos;NK1.6.1&apos;].toString()</stringValue>
                                <scriptExpression>true</scriptExpression>
                              </properties>
                            </objectProperty>
                          </entry>
                          <entry>
                            <string>use</string>
                            <objectProperty>
                              <enabled>true</enabled>
                              <properties class="stringModel">
                                <stringValue>work</stringValue>
                                <usingEnum>true</usingEnum>
                              </properties>
                            </objectProperty>
                          </entry>
                        </properties>
                      </model>
                    </com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
                  </children>
                </properties>
              </com.mirth.connect.model.IteratorStep>
            </children>
          </properties>
        </com.mirth.connect.model.IteratorStep>
        <com.mirth.connect.model.IteratorStep>
          <name>For each msg[&apos;NK1&apos;]</name>
          <sequenceNumber>8</sequenceNumber>
          <properties>
            <target>msg[&apos;NK1&apos;]</target>
            <indexVariable>i</indexVariable>
            <prefixSubstitutions>
              <string>msg[&apos;NK1&apos;]</string>
              <string>tmp[&apos;NK1&apos;]</string>
            </prefixSubstitutions>
            <children>
              <com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
                <name>Create Patient_Contact</name>
                <sequenceNumber>8-0</sequenceNumber>
                <storeAsLocal>true</storeAsLocal>
                <mapType>CHANNEL</mapType>
                <variable>contacts</variable>
                <definition>Patient_Contact</definition>
                <model class="objectModel">
                  <usingBuilder>true</usingBuilder>
                  <properties class="linked-hash-map">
                    <entry>
                      <string>relationship</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="arrayModel">
                          <usingBuilder>true</usingBuilder>
                          <elements>
                            <objectModel>
                              <usingBuilder>true</usingBuilder>
                              <properties class="linked-hash-map">
                                <entry>
                                  <string>text</string>
                                  <objectProperty>
                                    <enabled>true</enabled>
                                    <properties class="stringModel">
                                      <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.3&apos;][&apos;NK1.3.2&apos;].toString()</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </objectProperty>
                                </entry>
                                <entry>
                                  <string>id</string>
                                  <objectProperty>
                                    <enabled>true</enabled>
                                    <properties class="stringModel">
                                      <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.3&apos;][&apos;NK1.3.1&apos;].toString()</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </objectProperty>
                                </entry>
                              </properties>
                            </objectModel>
                            <objectModel>
                              <usingBuilder>true</usingBuilder>
                              <properties class="linked-hash-map">
                                <entry>
                                  <string>text</string>
                                  <objectProperty>
                                    <enabled>true</enabled>
                                    <properties class="stringModel">
                                      <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.7&apos;][&apos;NK1.7.2&apos;].toString()</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </objectProperty>
                                </entry>
                                <entry>
                                  <string>id</string>
                                  <objectProperty>
                                    <enabled>true</enabled>
                                    <properties class="stringModel">
                                      <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.7&apos;][&apos;NK1.7.1&apos;].toString()</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </objectProperty>
                                </entry>
                              </properties>
                            </objectModel>
                          </elements>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>name</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="objectModel">
                          <usingBuilder>true</usingBuilder>
                          <properties class="linked-hash-map">
                            <entry>
                              <string>use</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="stringModel">
                                  <stringValue>usual</stringValue>
                                  <usingEnum>true</usingEnum>
                                </properties>
                              </objectProperty>
                            </entry>
                            <entry>
                              <string>family</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="stringModel">
                                  <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.2&apos;][&apos;NK1.2.1&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </properties>
                              </objectProperty>
                            </entry>
                            <entry>
                              <string>given</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="arrayModel">
                                  <usingBuilder>true</usingBuilder>
                                  <elements>
                                    <stringModel>
                                      <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.2&apos;][&apos;NK1.2.2&apos;].toString()</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </stringModel>
                                    <stringModel>
                                      <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.2&apos;][&apos;NK1.2.3&apos;].toString()</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </stringModel>
                                  </elements>
                                </properties>
                              </objectProperty>
                            </entry>
                            <entry>
                              <string>prefix</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="arrayModel">
                                  <usingBuilder>true</usingBuilder>
                                  <elements>
                                    <stringModel>
                                      <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.2&apos;][&apos;NK1.2.5&apos;].toString()</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </stringModel>
                                  </elements>
                                </properties>
                              </objectProperty>
                            </entry>
                            <entry>
                              <string>suffix</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="arrayModel">
                                  <usingBuilder>true</usingBuilder>
                                  <elements>
                                    <stringModel>
                                      <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.2&apos;][&apos;NK1.2.4&apos;].toString()</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </stringModel>
                                  </elements>
                                </properties>
                              </objectProperty>
                            </entry>
                            <entry>
                              <string>period</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="objectModel">
                                  <usingBuilder>true</usingBuilder>
                                  <properties class="linked-hash-map">
                                    <entry>
                                      <string>start</string>
                                      <objectProperty>
                                        <enabled>true</enabled>
                                        <properties class="stringModel">
                                          <stringValue>convertToFhirTimestamp(msg[&apos;NK1&apos;][i][&apos;NK1.2&apos;][&apos;NK1.2.12&apos;].toString())</stringValue>
                                          <scriptExpression>true</scriptExpression>
                                        </properties>
                                      </objectProperty>
                                    </entry>
                                    <entry>
                                      <string>end</string>
                                      <objectProperty>
                                        <enabled>true</enabled>
                                        <properties class="stringModel">
                                          <stringValue>convertToFhirTimestamp(msg[&apos;NK1&apos;][i][&apos;NK1.2&apos;][&apos;NK1.2.13&apos;].toString())</stringValue>
                                          <scriptExpression>true</scriptExpression>
                                        </properties>
                                      </objectProperty>
                                    </entry>
                                  </properties>
                                </properties>
                              </objectProperty>
                            </entry>
                          </properties>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>telecom</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="arrayModel">
                          <stringValue>combineArrays(contactHomePhoneNumbers, contactBusinessPhoneNumbers)</stringValue>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>address</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="objectModel">
                          <usingBuilder>true</usingBuilder>
                          <properties class="linked-hash-map">
                            <entry>
                              <string>use</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="stringModel">
                                  <stringValue>convertAddressUse(msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.7&apos;].toString())</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </properties>
                              </objectProperty>
                            </entry>
                            <entry>
                              <string>type</string>
                              <objectProperty>
                                <enabled>false</enabled>
                                <properties class="stringModel">
                                  <stringValue>postal</stringValue>
                                  <usingEnum>true</usingEnum>
                                </properties>
                              </objectProperty>
                            </entry>
                            <entry>
                              <string>text</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="stringModel">
                                  <stringValue>(msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.1&apos;].toString() + &apos; &apos; + msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.2&apos;].toString() + &apos; &apos; + msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.3&apos;].toString() + &apos; &apos; + msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.4&apos;].toString() + &apos; &apos; + msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.5&apos;].toString() + &apos; &apos; + msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.6&apos;].toString()).trim()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </properties>
                              </objectProperty>
                            </entry>
                            <entry>
                              <string>line</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="arrayModel">
                                  <usingBuilder>true</usingBuilder>
                                  <elements>
                                    <stringModel>
                                      <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.1&apos;].toString()</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </stringModel>
                                    <stringModel>
                                      <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.2&apos;].toString()</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </stringModel>
                                  </elements>
                                </properties>
                              </objectProperty>
                            </entry>
                            <entry>
                              <string>city</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="stringModel">
                                  <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.3&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </properties>
                              </objectProperty>
                            </entry>
                            <entry>
                              <string>district</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="stringModel">
                                  <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.9&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </properties>
                              </objectProperty>
                            </entry>
                            <entry>
                              <string>state</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="stringModel">
                                  <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.4&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </properties>
                              </objectProperty>
                            </entry>
                            <entry>
                              <string>postalCode</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="stringModel">
                                  <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.5&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </properties>
                              </objectProperty>
                            </entry>
                            <entry>
                              <string>country</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="stringModel">
                                  <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.6&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </properties>
                              </objectProperty>
                            </entry>
                            <entry>
                              <string>period</string>
                              <objectProperty>
                                <enabled>true</enabled>
                                <properties class="objectModel">
                                  <usingBuilder>true</usingBuilder>
                                  <properties class="linked-hash-map">
                                    <entry>
                                      <string>start</string>
                                      <objectProperty>
                                        <enabled>true</enabled>
                                        <properties class="stringModel">
                                          <stringValue>convertToFhirTimestamp(msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.13&apos;].toString())</stringValue>
                                          <scriptExpression>true</scriptExpression>
                                        </properties>
                                      </objectProperty>
                                    </entry>
                                    <entry>
                                      <string>end</string>
                                      <objectProperty>
                                        <enabled>true</enabled>
                                        <properties class="stringModel">
                                          <stringValue>convertToFhirTimestamp(msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.14&apos;].toString())</stringValue>
                                          <scriptExpression>true</scriptExpression>
                                        </properties>
                                      </objectProperty>
                                    </entry>
                                  </properties>
                                </properties>
                              </objectProperty>
                            </entry>
                          </properties>
                        </properties>
                      </objectProperty>
                    </entry>
                    <entry>
                      <string>gender</string>
                      <objectProperty>
                        <enabled>true</enabled>
                        <properties class="stringModel">
                          <stringValue>convertToFhirGender(msg[&apos;NK1&apos;][i][&apos;NK1.15&apos;][&apos;NK1.15.1&apos;].toString())</stringValue>
                          <scriptExpression>true</scriptExpression>
                        </properties>
                      </objectProperty>
                    </entry>
                  </properties>
                </model>
              </com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
            </children>
          </properties>
        </com.mirth.connect.model.IteratorStep>
        <com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
          <name>Create Patient</name>
          <sequenceNumber>9</sequenceNumber>
          <storeAsLocal>true</storeAsLocal>
          <mapType>CHANNEL</mapType>
          <variable>patient</variable>
          <definition>Patient</definition>
          <model class="objectModel">
            <usingBuilder>true</usingBuilder>
            <properties class="linked-hash-map">
              <entry>
                <string>resourceType</string>
                <objectProperty>
                  <enabled>true</enabled>
                  <properties class="stringModel">
                    <stringValue>Patient</stringValue>
                    <usingEnum>true</usingEnum>
                  </properties>
                </objectProperty>
              </entry>
              <entry>
                <string>identifier</string>
                <objectProperty>
                  <enabled>true</enabled>
                  <properties class="arrayModel">
                    <stringValue>identifiers</stringValue>
                  </properties>
                </objectProperty>
              </entry>
              <entry>
                <string>name</string>
                <objectProperty>
                  <enabled>true</enabled>
                  <properties class="arrayModel">
                    <stringValue>combineArrays(names, aliases)</stringValue>
                  </properties>
                </objectProperty>
              </entry>
              <entry>
                <string>telecom</string>
                <objectProperty>
                  <enabled>true</enabled>
                  <properties class="arrayModel">
                    <stringValue>combineArrays(homePhoneNumbers, businessPhoneNumbers)</stringValue>
                  </properties>
                </objectProperty>
              </entry>
              <entry>
                <string>gender</string>
                <objectProperty>
                  <enabled>true</enabled>
                  <properties class="stringModel">
                    <stringValue>convertToFhirGender(msg[&apos;PID&apos;][&apos;PID.8&apos;][&apos;PID.8.1&apos;].toString())</stringValue>
                    <scriptExpression>true</scriptExpression>
                  </properties>
                </objectProperty>
              </entry>
              <entry>
                <string>birthDate</string>
                <objectProperty>
                  <enabled>true</enabled>
                  <properties class="stringModel">
                    <stringValue>convertToFhirDate(msg[&apos;PID&apos;][&apos;PID.7&apos;][&apos;PID.7.1&apos;].toString())</stringValue>
                    <scriptExpression>true</scriptExpression>
                  </properties>
                </objectProperty>
              </entry>
              <entry>
                <string>deceasedBoolean</string>
                <objectProperty>
                  <enabled>true</enabled>
                  <properties class="booleanModel">
                    <stringValue>convertYesNoIndicator(msg[&apos;PID&apos;][&apos;PID.30&apos;][&apos;PID.30.1&apos;].toString())</stringValue>
                  </properties>
                </objectProperty>
              </entry>
              <entry>
                <string>deceasedDateTime</string>
                <objectProperty>
                  <enabled>true</enabled>
                  <properties class="stringModel">
                    <stringValue>convertToFhirTimestamp(msg[&apos;PID&apos;][&apos;PID.29&apos;][&apos;PID.29.1&apos;].toString())</stringValue>
                    <scriptExpression>true</scriptExpression>
                  </properties>
                </objectProperty>
              </entry>
              <entry>
                <string>address</string>
                <objectProperty>
                  <enabled>true</enabled>
                  <properties class="arrayModel">
                    <stringValue>addresses</stringValue>
                  </properties>
                </objectProperty>
              </entry>
              <entry>
                <string>maritalStatus</string>
                <objectProperty>
                  <enabled>true</enabled>
                  <properties class="objectModel">
                    <usingBuilder>true</usingBuilder>
                    <properties class="linked-hash-map">
                      <entry>
                        <string>text</string>
                        <objectProperty>
                          <enabled>true</enabled>
                          <properties class="stringModel">
                            <stringValue>msg[&apos;PID&apos;][&apos;PID.16&apos;][&apos;PID.16.1&apos;].toString()</stringValue>
                            <scriptExpression>true</scriptExpression>
                          </properties>
                        </objectProperty>
                      </entry>
                    </properties>
                  </properties>
                </objectProperty>
              </entry>
              <entry>
                <string>multipleBirthBoolean</string>
                <objectProperty>
                  <enabled>true</enabled>
                  <properties class="booleanModel">
                    <stringValue>convertYesNoIndicator(msg[&apos;PID&apos;][&apos;PID.24&apos;][&apos;PID.24.1&apos;].toString())</stringValue>
                  </properties>
                </objectProperty>
              </entry>
              <entry>
                <string>contact</string>
                <objectProperty>
                  <enabled>true</enabled>
                  <properties class="arrayModel">
                    <stringValue>contacts</stringValue>
                  </properties>
                </objectProperty>
              </entry>
              <entry>
                <string>communication</string>
                <objectProperty>
                  <enabled>true</enabled>
                  <properties class="arrayModel">
                    <usingBuilder>true</usingBuilder>
                    <elements>
                      <objectModel>
                        <usingBuilder>true</usingBuilder>
                        <properties class="linked-hash-map">
                          <entry>
                            <string>language</string>
                            <objectProperty>
                              <enabled>true</enabled>
                              <properties class="objectModel">
                                <usingBuilder>true</usingBuilder>
                                <properties class="linked-hash-map">
                                  <entry>
                                    <string>text</string>
                                    <objectProperty>
                                      <enabled>true</enabled>
                                      <properties class="stringModel">
                                        <stringValue>msg[&apos;PID&apos;][&apos;PID.15&apos;][&apos;PID.15.2&apos;].toString()</stringValue>
                                        <scriptExpression>true</scriptExpression>
                                      </properties>
                                    </objectProperty>
                                  </entry>
                                  <entry>
                                    <string>id</string>
                                    <objectProperty>
                                      <enabled>true</enabled>
                                      <properties class="stringModel">
                                        <stringValue>msg[&apos;PID&apos;][&apos;PID.15&apos;][&apos;PID.15.1&apos;].toString()</stringValue>
                                        <scriptExpression>true</scriptExpression>
                                      </properties>
                                    </objectProperty>
                                  </entry>
                                </properties>
                              </properties>
                            </objectProperty>
                          </entry>
                        </properties>
                      </objectModel>
                    </elements>
                  </properties>
                </objectProperty>
              </entry>
            </properties>
          </model>
        </com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
        <com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
          <name>Cleanup, and set msg</name>
          <sequenceNumber>10</sequenceNumber>
          <script>msg = consolidate(cleanupFhirPatient(patient));</script>
        </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
      </elements>
      <inboundTemplate encoding="base64"></inboundTemplate>
      <outboundTemplate encoding="base64"></outboundTemplate>
      <inboundDataType>HL7V2</inboundDataType>
      <outboundDataType>FHIR</outboundDataType>
      <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.6.0">
        <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.6.0">
          <handleRepetitions>true</handleRepetitions>
          <handleSubcomponents>true</handleSubcomponents>
          <useStrictParser>false</useStrictParser>
          <useStrictValidation>false</useStrictValidation>
          <stripNamespaces>true</stripNamespaces>
          <segmentDelimiter>\r</segmentDelimiter>
          <convertLineBreaks>true</convertLineBreaks>
        </serializationProperties>
        <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.6.0">
          <useStrictParser>false</useStrictParser>
          <useStrictValidation>false</useStrictValidation>
          <segmentDelimiter>\r</segmentDelimiter>
        </deserializationProperties>
        <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.6.0">
          <splitType>MSH_Segment</splitType>
          <batchScript></batchScript>
        </batchProperties>
        <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.6.0">
          <segmentDelimiter>\r</segmentDelimiter>
          <successfulACKCode>AA</successfulACKCode>
          <successfulACKMessage></successfulACKMessage>
          <errorACKCode>AE</errorACKCode>
          <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
          <rejectedACKCode>AR</rejectedACKCode>
          <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
          <msh15ACKAccept>false</msh15ACKAccept>
          <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
        </responseGenerationProperties>
        <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.6.0">
          <successfulACKCode>AA,CA</successfulACKCode>
          <errorACKCode>AE,CE</errorACKCode>
          <rejectedACKCode>AR,CR</rejectedACKCode>
          <validateMessageControlId>true</validateMessageControlId>
          <originalMessageControlId>Destination_Encoded</originalMessageControlId>
          <originalIdMapVariable></originalIdMapVariable>
        </responseValidationProperties>
      </inboundProperties>
      <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.6.0">
        <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.6.0">
          <serializationType>JSON</serializationType>
        </serializationProperties>
        <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.6.0">
          <serializationType>JSON</serializationType>
        </deserializationProperties>
        <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.6.0">
          <splitType>JavaScript</splitType>
          <batchScript></batchScript>
        </batchProperties>
      </outboundProperties>
    </transformer>
    <filter version="3.6.0">
      <elements/>
    </filter>
    <transportName>Channel Reader</transportName>
    <mode>SOURCE</mode>
    <enabled>true</enabled>
    <waitForPrevious>true</waitForPrevious>
  </sourceConnector>
  <destinationConnectors>
    <connector version="3.6.0">
      <metaDataId>1</metaDataId>
      <name>Destination 1</name>
      <properties class="com.mirth.connect.connectors.vm.VmDispatcherProperties" version="3.6.0">
        <pluginProperties/>
        <destinationConnectorProperties version="3.6.0">
          <queueEnabled>false</queueEnabled>
          <sendFirst>false</sendFirst>
          <retryIntervalMillis>10000</retryIntervalMillis>
          <regenerateTemplate>false</regenerateTemplate>
          <retryCount>0</retryCount>
          <rotate>false</rotate>
          <includeFilterTransformer>false</includeFilterTransformer>
          <threadCount>1</threadCount>
          <threadAssignmentVariable></threadAssignmentVariable>
          <validateResponse>false</validateResponse>
          <resourceIds class="linked-hash-map">
            <entry>
              <string>Default Resource</string>
              <string>[Default Resource]</string>
            </entry>
          </resourceIds>
          <queueBufferSize>1000</queueBufferSize>
          <reattachAttachments>true</reattachAttachments>
        </destinationConnectorProperties>
        <channelId>none</channelId>
        <channelTemplate>${message.encodedData}</channelTemplate>
        <mapVariables/>
      </properties>
      <transformer version="3.6.0">
        <elements/>
        <inboundDataType>FHIR</inboundDataType>
        <outboundDataType>FHIR</outboundDataType>
        <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.6.0">
          <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.6.0">
            <serializationType>JSON</serializationType>
          </serializationProperties>
          <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.6.0">
            <serializationType>JSON</serializationType>
          </deserializationProperties>
          <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.6.0">
            <splitType>JavaScript</splitType>
            <batchScript></batchScript>
          </batchProperties>
        </inboundProperties>
        <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.6.0">
          <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.6.0">
            <serializationType>JSON</serializationType>
          </serializationProperties>
          <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.6.0">
            <serializationType>JSON</serializationType>
          </deserializationProperties>
          <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.6.0">
            <splitType>JavaScript</splitType>
            <batchScript></batchScript>
          </batchProperties>
        </outboundProperties>
      </transformer>
      <responseTransformer version="3.6.0">
        <elements/>
        <inboundDataType>FHIR</inboundDataType>
        <outboundDataType>FHIR</outboundDataType>
        <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.6.0">
          <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.6.0">
            <serializationType>JSON</serializationType>
          </serializationProperties>
          <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.6.0">
            <serializationType>JSON</serializationType>
          </deserializationProperties>
          <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.6.0">
            <splitType>JavaScript</splitType>
            <batchScript></batchScript>
          </batchProperties>
        </inboundProperties>
        <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.6.0">
          <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.6.0">
            <serializationType>JSON</serializationType>
          </serializationProperties>
          <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.6.0">
            <serializationType>JSON</serializationType>
          </deserializationProperties>
          <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.6.0">
            <splitType>JavaScript</splitType>
            <batchScript></batchScript>
          </batchProperties>
        </outboundProperties>
      </responseTransformer>
      <filter version="3.6.0">
        <elements/>
      </filter>
      <transportName>Channel Writer</transportName>
      <mode>DESTINATION</mode>
      <enabled>true</enabled>
      <waitForPrevious>true</waitForPrevious>
    </connector>
  </destinationConnectors>
  <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
  <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
  <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
  <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
  <properties version="3.6.0">
    <clearGlobalChannelMap>true</clearGlobalChannelMap>
    <messageStorageMode>DEVELOPMENT</messageStorageMode>
    <encryptData>false</encryptData>
    <removeContentOnCompletion>false</removeContentOnCompletion>
    <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
    <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
    <initialState>STARTED</initialState>
    <storeAttachments>true</storeAttachments>
    <metaDataColumns>
      <metaDataColumn>
        <name>SOURCE</name>
        <type>STRING</type>
        <mappingName>mirth_source</mappingName>
      </metaDataColumn>
      <metaDataColumn>
        <name>TYPE</name>
        <type>STRING</type>
        <mappingName>mirth_type</mappingName>
      </metaDataColumn>
    </metaDataColumns>
    <attachmentProperties version="3.6.0">
      <type>None</type>
      <properties/>
    </attachmentProperties>
    <resourceIds class="linked-hash-map">
      <entry>
        <string>Default Resource</string>
        <string>[Default Resource]</string>
      </entry>
    </resourceIds>
  </properties>
  <exportData>
    <metadata>
      <enabled>true</enabled>
      <lastModified>
        <time>1527186759431</time>
        <timezone>America/Los_Angeles</timezone>
      </lastModified>
      <pruningSettings>
        <archiveEnabled>true</archiveEnabled>
      </pruningSettings>
    </metadata>
    <codeTemplateLibraries>
      <codeTemplateLibrary version="3.6.0">
        <id>9025896a-65d0-458c-92ac-335fe985a232</id>
        <name>HL7 v2.x to FHIR Helper Functions</name>
        <revision>1</revision>
        <lastModified>
          <time>1527186638717</time>
          <timezone>America/Los_Angeles</timezone>
        </lastModified>
        <description>General functions to help convert HL7 v2.x to FHIR resources.

These are used by the example HL7 to FHIR transformer, as well as
the &quot;HL7 v2.x to FHIR Creation Functions&quot; code template library.</description>
        <includeNewChannels>false</includeNewChannels>
        <enabledChannelIds>
          <string>e678dbf5-f021-43dc-84ae-967500d5c31a</string>
        </enabledChannelIds>
        <disabledChannelIds/>
        <codeTemplates>
          <codeTemplate version="3.6.0">
            <id>2cc062f8-aac9-48e1-947e-0567d4497e07</id>
            <name>Cleanup FHIR Patient</name>
            <revision>1</revision>
            <lastModified>
              <time>1527107940612</time>
              <timezone>America/Los_Angeles</timezone>
            </lastModified>
            <contextSet>
              <delegate>
                <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                <contextType>DESTINATION_DISPATCHER</contextType>
                <contextType>SOURCE_RECEIVER</contextType>
                <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
              </delegate>
            </contextSet>
            <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
              <type>FUNCTION</type>
              <code>/**
	Removes name / telecom / address entries with no actual value.

	@param {Object} patient - The JavaScript Object representing the FHIR Patient.
	@return {Object} The same Object passed in, cleaned up.
*/
function cleanupFhirPatient(patient) {
	// Remove names with no value
	cleanupFhirNames(patient, &apos;name&apos;);
	
	// Remove telecom entries with no value
	cleanupFhirTelecoms(patient, &apos;telecom&apos;);

	// Remove address entries with no value
	cleanupFhirAddresses(patient, &apos;address&apos;);

	if (patient.contact) {
		for each (contact in patient.contact) {
			if (!isFhirNameValid(contact.name)) {
				delete contact.name;
			}
			
			cleanupFhirTelecoms(contact, &apos;telecom&apos;);

			if (!isFhirAddressValid(contact.address)) {
				delete contact.address;
			}
		}
	}

	return patient;
}

function cleanupFhirNames(parent, property) {
	cleanupArray(parent, property, isFhirNameValid);
}

function isFhirNameValid(name) {
	return name &amp;&amp; (!isValueEmpty(name.text) || !isValueEmpty(name.family) || !isValueEmpty(name.given) || !isValueEmpty(name.prefix) || !isValueEmpty(name.suffix));
}

function cleanupFhirTelecoms(parent, property) {
	cleanupArray(parent, property, function(telecom) {
		return !isValueEmpty(telecom.value);
	});
}

function cleanupFhirAddresses(parent, property) {
	cleanupArray(parent, property, isFhirAddressValid);
}

function isFhirAddressValid(address) {
	return address &amp;&amp; (!isValueEmpty(address.text) || !isValueEmpty(address.line) || !isValueEmpty(address.city) || !isValueEmpty(address.state) || !isValueEmpty(address.postalCode) || !isValueEmpty(address.country));
}

function cleanupArray(parent, property, handleFunction) {
	var arr = parent[property];

	if (arr) {
		var length = arr.length;
		for (var i = length - 1; i &gt;= 0; i--) {
			if (!handleFunction(arr[i])) {
				delete arr[i];
				length--;
			}
		}
		arr.length = length;

		// Handle Java arrays
		if (arr.length != length) {
			parent[property] = org.apache.commons.lang3.ArrayUtils.subarray(arr, 0, length);
		}
	}
}</code>
            </properties>
          </codeTemplate>
          <codeTemplate version="3.6.0">
            <id>2e62489a-423d-4471-a919-ed3f71827199</id>
            <name>Combine Arrays</name>
            <revision>1</revision>
            <lastModified>
              <time>1527108809257</time>
              <timezone>America/Los_Angeles</timezone>
            </lastModified>
            <contextSet>
              <delegate>
                <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                <contextType>DESTINATION_DISPATCHER</contextType>
                <contextType>SOURCE_RECEIVER</contextType>
                <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
              </delegate>
            </contextSet>
            <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
              <type>FUNCTION</type>
              <code>/**
	Combines two arrays into one. Works with both Java and JavaScript arrays.

	@param {Array} array1 - The first array.
	@param {Array} array2 - The second array.
	@return {Array} The combined array.
*/
function combineArrays(array1, array2) {
	var isJavaArray1 = Object.prototype.toString.call(array1) == &apos;[object JavaArray]&apos;;
	var isJavaArray2 = Object.prototype.toString.call(array2) == &apos;[object JavaArray]&apos;;

	if (isJavaArray1 &amp;&amp; isJavaArray2) {
		return org.apache.commons.lang3.ArrayUtils.addAll(array1, array2);
	} else if (isJavaArray1) {
		for (var i = array1.length - 1; i &gt;= 0; i--) {
			array2.unshift(array1[i]);
		}
		return array2;
	} else {
		for each (value in array2) {
			array1.push(value);
		}
		return array1;
	}
}</code>
            </properties>
          </codeTemplate>
          <codeTemplate version="3.6.0">
            <id>6faf1e4b-d159-4d34-a07a-2fe0a3bde4cf</id>
            <name>Consolidate Empty Properties</name>
            <revision>1</revision>
            <lastModified>
              <time>1527106778328</time>
              <timezone>America/Los_Angeles</timezone>
            </lastModified>
            <contextSet>
              <delegate>
                <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                <contextType>DESTINATION_DISPATCHER</contextType>
                <contextType>SOURCE_RECEIVER</contextType>
                <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
              </delegate>
            </contextSet>
            <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
              <type>FUNCTION</type>
              <code>/**
	Removes empty strings, objects and arrays from a JavaScript object.

	@param {Object/Array} obj - The object or array to consolidate.
	@return {Object/Array} The consolidates object or array.
*/
function consolidate(obj) {
	if (typeof obj != &apos;undefined&apos; &amp;&amp; obj != null) {
		var protoToString = Object.prototype.toString.call(obj);
		
		if (obj instanceof Array || protoToString == &apos;[object Array]&apos; || protoToString == &apos;[object JavaArray]&apos;) {
			var length = obj.length;
			
			for (var i = obj.length - 1; i &gt;= 0; i--) {
				if (!doConsolidate(obj, i)) {
					length--;
				}
			}
			obj.length = length;

			// Handle Java Arrays
			if (length != obj.length) {
				obj = org.apache.commons.lang3.ArrayUtils.subarray(obj, 0, length);
			}
		} else if (protoToString == &apos;[object Object]&apos;) {
			for (var property in obj) {
				doConsolidate(obj, property);
			}
		}
	}
	return obj;
}

function doConsolidate(obj, property) {
	var value = obj[property] = consolidate(obj[property]);
	var empty = isValueEmpty(value);
	if (empty) {
		delete obj[property];
	}
	return !empty;
}

function isValueEmpty(value) {
	var protoToString = Object.prototype.toString.call(value);

	if (typeof value == &apos;undefined&apos; || value == null) {
		return true;
	} else if (value instanceof Array || protoToString == &apos;[object Array]&apos; || protoToString == &apos;[object JavaArray]&apos;) {
		if (value.length &gt; 0) {
			for each (element in value) {
				if (!isValueEmpty(element)) {
					return false;
				}
			}
		}
		return true;
	} else if (typeof value == &apos;string&apos; || protoToString == &apos;[object String]&apos;) {
		return value.length == 0;
	} else if (value instanceof java.lang.String) {
		return org.apache.commons.lang3.StringUtils.isEmpty(value);
	} else if (protoToString == &apos;[object Object]&apos;) {
		for (var property in value) {
			if (!isValueEmpty(value[property])) {
				return false;
			}
		}
		return true;
	}

	return false;
}
</code>
            </properties>
          </codeTemplate>
          <codeTemplate version="3.6.0">
            <id>b7bffbe4-9da5-40a8-8a35-7e3ad5a9bebf</id>
            <name>Convert Address Use</name>
            <revision>1</revision>
            <lastModified>
              <time>1527091249839</time>
              <timezone>America/Los_Angeles</timezone>
            </lastModified>
            <contextSet>
              <delegate>
                <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                <contextType>DESTINATION_DISPATCHER</contextType>
                <contextType>SOURCE_RECEIVER</contextType>
                <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
              </delegate>
            </contextSet>
            <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
              <type>FUNCTION</type>
              <code>/**
	Converts an HL7 v2.x address type code to the corresponding FHIR address use.

	@param {String} code - The HL7 address type (Table 0190)
	@return {String} The FHIR address use code
*/
function convertAddressUse(code) {
	var fhirCode;
	
	switch ((code + &apos;&apos;).toUpperCase()) {
		case &apos;H&apos;:
		case &apos;L&apos;:
		case &apos;M&apos;:
		case &apos;P&apos;:
		case &apos;SH&apos;:
			fhirCode = org.hl7.fhir.dstu3.model.codesystems.AddressUse.HOME;
			break;
		case &apos;B&apos;:
		case &apos;O&apos;:
		case &apos;BI&apos;:
			fhirCode = org.hl7.fhir.dstu3.model.codesystems.AddressUse.WORK;
			break;
		case &apos;C&apos;:
		case &apos;V&apos;:
			fhirCode = org.hl7.fhir.dstu3.model.codesystems.AddressUse.TEMP;
			break;
		default:
			fhirCode = org.hl7.fhir.dstu3.model.codesystems.AddressUse.OLD;
	}

	return fhirCode.toCode();
}</code>
            </properties>
          </codeTemplate>
          <codeTemplate version="3.6.0">
            <id>687a3eef-3155-47c8-bb12-de158d0055ac</id>
            <name>Convert Date</name>
            <revision>1</revision>
            <lastModified>
              <time>1527089001731</time>
              <timezone>America/Los_Angeles</timezone>
            </lastModified>
            <contextSet>
              <delegate>
                <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                <contextType>DESTINATION_DISPATCHER</contextType>
                <contextType>SOURCE_RECEIVER</contextType>
                <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
              </delegate>
            </contextSet>
            <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
              <type>FUNCTION</type>
              <code>/**
	Converts an HL7 v2.x formatted date into the correct format for FHIR date.
	
	HL7 format expected: yyyyMMdd
	FHIR format: yyyy-MM-dd

	@param {String} date - The HL7 v2.x date string
	@return {String} The converted FHIR date string
*/
function convertToFhirDate(date) {
	return convertToFhirTimestamp(date, &quot;yyyy-MM-dd&quot;);
}</code>
            </properties>
          </codeTemplate>
          <codeTemplate version="3.6.0">
            <id>f338c38c-477a-4dca-8714-2e96c382716e</id>
            <name>Convert Gender</name>
            <revision>1</revision>
            <lastModified>
              <time>1527094560813</time>
              <timezone>America/Los_Angeles</timezone>
            </lastModified>
            <contextSet>
              <delegate>
                <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                <contextType>DESTINATION_DISPATCHER</contextType>
                <contextType>SOURCE_RECEIVER</contextType>
                <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
              </delegate>
            </contextSet>
            <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
              <type>FUNCTION</type>
              <code>/**
	Converts an HL7 v2.x gender code to the corresponding FHIR code.

	@param {String} code - The HL7 gender code (Table 0001)
	@return {String} The FHIR administrative gender code
*/
function convertToFhirGender(code) {
	var fhirCode;
	
	switch ((code + &apos;&apos;).toUpperCase()) {
		case &apos;F&apos;:
			fhirCode = org.hl7.fhir.dstu3.model.codesystems.AdministrativeGender.FEMALE;
			break;
		case &apos;M&apos;:
			fhirCode = org.hl7.fhir.dstu3.model.codesystems.AdministrativeGender.MALE;
			break;
		case &apos;O&apos;:
		case &apos;A&apos;:
		case &apos;N&apos;:
			fhirCode = org.hl7.fhir.dstu3.model.codesystems.AdministrativeGender.OTHER;
			break;
		case &apos;U&apos;:
		default:
			fhirCode = org.hl7.fhir.dstu3.model.codesystems.AdministrativeGender.UNKNOWN;
	}

	return fhirCode.toCode();
}</code>
            </properties>
          </codeTemplate>
          <codeTemplate version="3.6.0">
            <id>0061fef8-39be-48c1-b81e-60719c97c149</id>
            <name>Convert Timestamp</name>
            <revision>1</revision>
            <lastModified>
              <time>1527089001719</time>
              <timezone>America/Los_Angeles</timezone>
            </lastModified>
            <contextSet>
              <delegate>
                <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                <contextType>DESTINATION_DISPATCHER</contextType>
                <contextType>SOURCE_RECEIVER</contextType>
                <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
              </delegate>
            </contextSet>
            <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
              <type>FUNCTION</type>
              <code>/**
	Converts an HL7 v2.x formatted timestamp into the correct format for FHIR dateTime.
	
	HL7 format expected: yyyyMMddHHmmssZZ
	FHIR format: yyyy-MM-dd&apos;T&apos;HH:mm:ssZZ

	@param {String} date - The HL7 v2.x timestamp string
	@return {String} The converted FHIR timestamp string
*/
function convertToFhirTimestamp(date) {
	if (!date) {
		return &apos;&apos;;
	}

	var patterns = [
		&quot;yyyyMMddHHmmss.SSSZZ&quot;,
		&quot;yyyyMMddHHmmss.SSSZ&quot;,
		&quot;yyyyMMddHHmmss.SSS&quot;,
		&quot;yyyyMMddHHmmssZZ&quot;,
		&quot;yyyyMMddHHmmssZ&quot;,
		&quot;yyyyMMddHHmmss&quot;,
		&quot;yyyyMMddHHmm&quot;,
		&quot;yyyyMMddHH&quot;,
		&quot;yyyyMMdd&quot;
	];

	var instant;
	for each (pattern in patterns) {
		try {
			instant = org.joda.time.format.DateTimeFormat.forPattern(pattern).parseMillis(new String(date));
			break;
		} catch(e) {}
	}

	if (instant) {
		var outpattern = arguments.length &gt;= 2 ? arguments[1] : &quot;yyyy-MM-dd&apos;T&apos;HH:mm:ssZZ&quot;;
		try {
			return org.joda.time.format.DateTimeFormat.forPattern(outpattern).print(instant);
		} catch (e) {}
	}
	
	return date;
}</code>
            </properties>
          </codeTemplate>
          <codeTemplate version="3.6.0">
            <id>760658e4-f24f-4a57-bbb9-9ae847f6daf8</id>
            <name>Convert Yes/No Indicator</name>
            <revision>1</revision>
            <lastModified>
              <time>1527091249810</time>
              <timezone>America/Los_Angeles</timezone>
            </lastModified>
            <contextSet>
              <delegate>
                <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                <contextType>DESTINATION_DISPATCHER</contextType>
                <contextType>SOURCE_RECEIVER</contextType>
                <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
              </delegate>
            </contextSet>
            <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
              <type>FUNCTION</type>
              <code>/**
	Converts an HL7 v2.x yes/no indicator code to a boolean value. If the code is null or an empty string,
	false will be returned.

	@param {String} code - The HL7 yes/no indicator (Table 0136)
	@return {Boolean} True/false
*/
function convertYesNoIndicator(code) {
	return code == &apos;Y&apos;;
}</code>
            </properties>
          </codeTemplate>
        </codeTemplates>
      </codeTemplateLibrary>
    </codeTemplateLibraries>
    <channelTags>
      <channelTag>
        <id>801da78a-5e23-458c-8771-2012cc1238f6</id>
        <name>FHIR</name>
        <channelIds>
          <string>e678dbf5-f021-43dc-84ae-967500d5c31a</string>
        </channelIds>
        <backgroundColor>
          <red>255</red>
          <green>0</green>
          <blue>0</blue>
          <alpha>255</alpha>
        </backgroundColor>
      </channelTag>
      <channelTag>
        <id>28eda82e-7385-4be1-b540-ed4505f81192</id>
        <name>HL7v2</name>
        <channelIds>
          <string>e678dbf5-f021-43dc-84ae-967500d5c31a</string>
        </channelIds>
        <backgroundColor>
          <red>0</red>
          <green>255</green>
          <blue>0</blue>
          <alpha>255</alpha>
        </backgroundColor>
      </channelTag>
    </channelTags>
  </exportData>
</channel>
